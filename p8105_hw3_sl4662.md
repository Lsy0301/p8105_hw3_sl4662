p8105\_hw3\_sl4662
================

# Problem 1

``` r
data("instacart")

nrow(distinct(instacart,aisle_id))  # total number of aisles 
```

    ## [1] 134

``` r
instacart %>% 
group_by(aisle) %>% 
summarize(n = n()) %>% 
filter(min_rank(desc(n))<2) # filter out only when rank = 1 (max)
```

    ## # A tibble: 1 x 2
    ##   aisle                 n
    ##   <chr>             <int>
    ## 1 fresh vegetables 150609

``` r
# mutate(ranking = min_rank(desc(n))) %>%  # rank aisle in max to min order
```

There are 134 aisles, and the most popular is fresh vegetables.

``` r
aisle_count =
  instacart %>% 
  group_by(aisle) %>% 
  summarize(n = n()) %>% 
  filter(n > 10000) # aisles with more than 10000 items ordered
  
ggplot(aisle_count, aes(x = n, y = reorder(aisle, n))) +
  geom_point(aes(color = aisle), alpha = .5) +  
  scale_color_hue(h = c(300, 600)) +
  scale_x_continuous(
    breaks = c(10000, 20000, 40000, 80000, 150000)
    ) +
    theme(legend.position = "none", axis.text.x = element_text(angle = 45)) +
  labs(
    title = "Aisle Data",
    x = "Number ordered",
    y = "Aisle Types"
  )
```

![](p8105_hw3_sl4662_files/figure-gfm/aisle_plot-1.png)<!-- -->

The most popular is fresh vegatibles. The second popular is fresh
fruits. Both fresh vegatables and fruits are ordered aound 150000 times.
The third popular is packaged vegatibles fruits, which is ordered around
80000 times.

``` r
baking=
  instacart %>%
  filter(aisle == "baking ingredients") %>% 
  count(product_name, aisle_name ="baking ingredients")  %>% 
  arrange(desc(n)) %>% 
  head(3)


dog = 
  instacart %>%
  filter(aisle == "dog food care") %>%
  count(product_name, aisle_name ="dog_food_care") %>% 
  arrange(desc(n)) %>% 
  head(3)



vegetables = 
  instacart %>%
  filter(aisle == "packaged vegetables fruits") %>%
  count(product_name, aisle_name ="packaged vegetables fruits") %>% 
  arrange(desc(n)) %>% 
  head(3)


three = bind_rows(baking, dog, vegetables) %>% 
  select(aisle_name, product_name, n) %>% 
  rename(., number_of_orders = n)
  
knitr::kable(three)
```

| aisle\_name                | product\_name                                 | number\_of\_orders |
| :------------------------- | :-------------------------------------------- | -----------------: |
| baking ingredients         | Light Brown Sugar                             |                499 |
| baking ingredients         | Pure Baking Soda                              |                387 |
| baking ingredients         | Cane Sugar                                    |                336 |
| dog\_food\_care            | Snack Sticks Chicken & Rice Recipe Dog Treats |                 30 |
| dog\_food\_care            | Organix Chicken & Brown Rice Recipe           |                 28 |
| dog\_food\_care            | Small Dog Biscuits                            |                 26 |
| packaged vegetables fruits | Organic Baby Spinach                          |               9784 |
| packaged vegetables fruits | Organic Raspberries                           |               5546 |
| packaged vegetables fruits | Organic Blueberries                           |               4966 |

The most popular product in baking ingredients aisle is light brown
sugar.

The most popular product in dog food care is snack sticks chicken & rice
recipe dog treats.

The most popular product in packaged vegetables fruits is orgainic baby
spinach. The top three popular products in packaged vegetables fruits
are all orgainic products.

``` r
apple =
  instacart %>%
  filter(product_name == "Pink Lady Apples") %>% 
  select(order_dow, order_hour_of_day, product_name) %>% 
  arrange(order_dow)

apple_weekday = 
  apple %>% 
  group_by(order_dow) %>%
  summarize(apple_mean_weight = mean(order_hour_of_day))

coffee =
  instacart %>%
  filter(product_name == "Coffee Ice Cream") %>% 
  select(order_dow, order_hour_of_day, product_name) %>% 
  arrange(order_dow)

coffee_weekday = 
  coffee %>% 
  group_by(order_dow) %>%
  summarize(coffee_mean_weight = mean(order_hour_of_day))

apple_weekday = pivot_wider(
  apple_weekday, 
  names_from = "order_dow", 
  values_from = "apple_mean_weight") 

apple_weekday = mutate(apple_weekday,type = "apple")

coffee_weekday = pivot_wider(
  coffee_weekday, 
  names_from = "order_dow", 
  values_from = "coffee_mean_weight")

coffee_weekday = mutate(coffee_weekday,type = "coffee")

apple_coffee = bind_rows(apple_weekday, coffee_weekday)

apple_coffee =
  apple_coffee %>% 
    select(type, everything()) %>% 
  mutate(
    type = recode(type, apple = "Pink Lady Apples", 
                      coffee = "Coffee Ice Cream")) %>% 
  rename(., Sunday = "0", Monday = "1", Tuesday = "2", Wednesday = "3", Thursday = "4", Friday = "5", Saturday = "6") 

knitr::kable(apple_coffee)
```

| type             |   Sunday |   Monday |  Tuesday | Wednesday | Thursday |   Friday | Saturday |
| :--------------- | -------: | -------: | -------: | --------: | -------: | -------: | -------: |
| Pink Lady Apples | 13.44118 | 11.36000 | 11.70213 |  14.25000 | 11.55172 | 12.78431 | 11.93750 |
| Coffee Ice Cream | 13.77419 | 14.31579 | 15.38095 |  15.31818 | 15.21739 | 12.26316 | 13.83333 |

Both orders of pink lady apples and coffee ice cream are placed around
noon to 3pm.

There are 15 variables in instacart data set, and 1384617 observations.
This data set is based on each item from different orders and different
times. For example, we can look at the first row. Bulgarian Yogurt has
product id 49302, it is in order 1, and it is added to the cart first.
It is the forth order being placed by user 112108 on Thursday. It has
been 9 days since this userâ€™s prior order. This product belongs to aisle
yogurt and department dairy eggs.

# Problem 2

``` r
data("brfss_smart2010") 

brfss = 
  brfss_smart2010 %>% 
  janitor::clean_names() %>% 
  filter(topic == "Overall Health") %>% 
  drop_na(response) %>% 
  mutate(response = factor(response, levels = c("Poor", "Fair", "Good", "Very good", "Excellent"))) %>% 
  arrange(response)

location_2002 = 
  brfss %>% 
  filter(year == "2002") %>% 
  distinct(locationdesc) %>% 
  separate(locationdesc, into = c("state", "location"), sep="-") %>% 
  count(state) %>% 
  filter(n > 6) 

location_2010 = 
  brfss %>% 
  filter(year == "2010") %>% 
  distinct(locationdesc) %>% 
  separate(locationdesc, into = c("state", "location"), sep="-") %>% 
  count(state) %>% 
  filter(n > 6)
```

In 2002, CT , FL , MA , NC , NJ , PA were observed at 7 or more
locations.

In 2010, CA , CO , FL , MA , MD , NC , NE , NJ , NY , OH , PA , SC , TX
, WA were observed at 7 or more locations.

More locations among states are being observed in 2010 compare to 2002.

``` r
plot_data = 
  brfss %>% 
  filter(response == "Excellent") %>% 
  select(year, locationabbr, response, data_value) %>% 
  drop_na() %>% 
  group_by(year, locationabbr) %>% 
  summarise(mean_data_value = mean(data_value))
  
ggplot(data = plot_data, aes(x = year, y = mean_data_value, color = locationabbr)) + 
  geom_line(aes(group = locationabbr)) +
  geom_text(aes(label = locationabbr),
            size = 2) +
  theme(legend.position = "right") +
  labs(
    color = "Location",
    title = "Excellent Responses Data Value over Time",
    x = "Year",
    y = "Average Data Value")
```

![](p8105_hw3_sl4662_files/figure-gfm/health_plot-1.png)<!-- -->

State WV has the lowest average data value among all sates. Overall, the
average data value decreased a little from year 2002 to 2010.
