 ---
title: "p8105_hw3_sl4662"
output: github_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggridges)
library(p8105.datasets)
```

# Problem 1
```{r, aisles_data}
data("instacart")

nrow(distinct(instacart,aisle_id))  # total number of aisles 

instacart %>% 
group_by(aisle) %>% 
summarize(n = n()) %>% 
filter(min_rank(desc(n))<2) # filter out only when rank = 1 (max)

# mutate(ranking = min_rank(desc(n))) %>%  # rank aisle in max to min order

```

There are `r nrow(distinct(instacart,aisle_id))` aisles, and the most popular is fresh vegetables. 

```{r, aisle_plot}
aisle_count =
  instacart %>% 
  group_by(aisle) %>% 
  summarize(n = n()) %>% 
  filter(n > 10000) # aisles with more than 10000 items ordered
  
ggplot(aisle_count, aes(x = n, y = reorder(aisle, n))) +
  geom_point(aes(color = aisle), alpha = .5) +  
  scale_color_hue(h = c(300, 600)) +
  scale_x_continuous(
    breaks = c(10000, 20000, 40000, 80000, 150000)
    ) +
    theme(legend.position = "none", axis.text.x = element_text(angle = 45)) +
  labs(
    title = "Aisle Data",
    x = "Number ordered",
    y = "Aisle Types"
  )
```

The most popular is fresh vegatibles. The second popular is fresh fruits. Both fresh vegatables and fruits are ordered aound 150000 times. The third popular is packaged vegatibles fruits, which is ordered around 80000 times. 

```{r, three_products}
baking=
  instacart %>%
  filter(aisle == "baking ingredients") %>% 
  count(product_name, aisle_name ="baking ingredients")  %>% 
  arrange(desc(n)) %>% 
  head(3)


dog = 
  instacart %>%
  filter(aisle == "dog food care") %>%
  count(product_name, aisle_name ="dog_food_care") %>% 
  arrange(desc(n)) %>% 
  head(3)



vegetables = 
  instacart %>%
  filter(aisle == "packaged vegetables fruits") %>%
  count(product_name, aisle_name ="packaged vegetables fruits") %>% 
  arrange(desc(n)) %>% 
  head(3)


three = bind_rows(baking, dog, vegetables) %>% 
  select(aisle_name, product_name, n) %>% 
  rename(., number_of_orders = n)
  
knitr::kable(three)
```

The most popular product in baking ingredients aisle is light brown sugar. 

The most popular product in dog food care is snack sticks chicken & rice recipe dog treats. 

The most popular product in packaged vegetables fruits is orgainic baby spinach. The top three popular products in packaged vegetables fruits are all orgainic products. 

```{r, apple_coffee}
apple =
  instacart %>%
  filter(product_name == "Pink Lady Apples") %>% 
  select(order_dow, order_hour_of_day, product_name) %>% 
  arrange(order_dow)

apple_weekday = 
  apple %>% 
  group_by(order_dow) %>%
  summarize(apple_mean_weight = mean(order_hour_of_day))

coffee =
  instacart %>%
  filter(product_name == "Coffee Ice Cream") %>% 
  select(order_dow, order_hour_of_day, product_name) %>% 
  arrange(order_dow)

coffee_weekday = 
  coffee %>% 
  group_by(order_dow) %>%
  summarize(coffee_mean_weight = mean(order_hour_of_day))

apple_weekday = pivot_wider(
  apple_weekday, 
  names_from = "order_dow", 
  values_from = "apple_mean_weight") 

apple_weekday = mutate(apple_weekday,type = "apple")

coffee_weekday = pivot_wider(
  coffee_weekday, 
  names_from = "order_dow", 
  values_from = "coffee_mean_weight")

coffee_weekday = mutate(coffee_weekday,type = "coffee")

apple_coffee = bind_rows(apple_weekday, coffee_weekday)

apple_coffee =
  apple_coffee %>% 
    select(type, everything()) %>% 
  mutate(
    type = recode(type, apple = "Pink Lady Apples", 
                      coffee = "Coffee Ice Cream")) %>% 
  rename(., Sunday = "0", Monday = "1", Tuesday = "2", Wednesday = "3", Thursday = "4", Friday = "5", Saturday = "6") 

knitr::kable(apple_coffee)
```

Both orders of pink lady apples and coffee ice cream are placed around noon to 3pm. 

There are `r ncol(instacart)` variables in instacart data set, and `r nrow(instacart)` observations. This data set is based on each item from different orders and different times. For example, we can look at the first row. Bulgarian Yogurt has product id 49302, it is in order 1, and it is added to the cart first. It is the forth order being placed by user 112108 on Thursday. It has been 9 days since this user's prior order. This product belongs to aisle yogurt and department dairy eggs. 